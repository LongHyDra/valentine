<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Valentine Interactive</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700;800&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --pink-1: #ffd7e8;
      --pink-2: #ffb7d2;
      --pink-3: #ff7fae;
      --pink-4: #ff4f90;
      --rose: #ff2f7f;
      --text: #7a1245;
      --white: #ffffff;
      --shadow: 0 18px 40px rgba(255, 79, 144, 0.28);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      overflow-x: hidden;
      font-family: "Quicksand", sans-serif;
      color: var(--text);
      background:
        radial-gradient(45rem 45rem at 12% -8%, rgba(255, 255, 255, 0.9) 0%, transparent 45%),
        radial-gradient(38rem 38rem at 90% 6%, rgba(255, 245, 250, 0.9) 0%, transparent 48%),
        linear-gradient(145deg, #ffe8f2 0%, #ffd6e8 34%, #ffc3dd 65%, #ffb6d6 100%);
      display: grid;
      place-items: center;
      padding: clamp(14px, 2.8vw, 26px);
    }

    .background-blur {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }

    .blob {
      position: absolute;
      border-radius: 999px;
      filter: blur(50px);
      opacity: 0.35;
      animation: drift 12s ease-in-out infinite alternate;
    }

    .blob.one {
      width: 280px;
      height: 280px;
      left: -60px;
      top: 15%;
      background: #ff8bb9;
    }

    .blob.two {
      width: 340px;
      height: 340px;
      right: -80px;
      bottom: 5%;
      background: #ff7ba5;
      animation-delay: -4s;
    }

    @keyframes drift {
      from { transform: translateY(-8px) translateX(0); }
      to { transform: translateY(14px) translateX(12px); }
    }

    .hearts-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }

    .falling-heart {
      position: absolute;
      top: -8vh;
      color: rgba(255, 88, 144, 0.48);
      text-shadow: 0 0 10px rgba(255, 80, 136, 0.18);
      animation: fall linear infinite;
      user-select: none;
      will-change: transform, opacity;
    }

    @keyframes fall {
      0% { transform: translate3d(0, -10vh, 0) rotate(0deg); opacity: 0; }
      12% { opacity: 1; }
      88% { opacity: 1; }
      100% { transform: translate3d(var(--drift, 30px), 110vh, 0) rotate(280deg); opacity: 0; }
    }

    .music-toggle {
      position: fixed;
      top: 16px;
      right: 16px;
      z-index: 12;
      border: 0;
      border-radius: 999px;
      padding: 10px 14px;
      background: rgba(255, 255, 255, 0.86);
      color: var(--rose);
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 10px 26px rgba(255, 76, 140, 0.2);
      backdrop-filter: blur(8px);
      font-family: inherit;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .music-toggle:hover { transform: translateY(-1px); }
    .music-toggle:active { transform: translateY(1px); }

    .app {
      position: relative;
      z-index: 5;
      width: min(940px, 100%);
      background: rgba(255, 255, 255, 0.76);
      border: 1px solid rgba(255, 255, 255, 0.9);
      box-shadow: var(--shadow);
      border-radius: 28px;
      backdrop-filter: blur(10px);
      overflow: hidden;
    }

    .app-inner {
      display: grid;
      grid-template-columns: 1.08fr 0.92fr;
      gap: clamp(16px, 2.4vw, 26px);
      padding: clamp(18px, 3vw, 30px);
    }

    .left, .right {
      background: rgba(255, 255, 255, 0.62);
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.95);
      padding: clamp(14px, 2vw, 22px);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.7);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 12px;
      letter-spacing: 0.4px;
      text-transform: uppercase;
      font-weight: 700;
      color: #c32263;
      background: rgba(255, 121, 175, 0.15);
      margin-bottom: 10px;
    }

    .big-question {
      margin: 0;
      font-family: "Baloo 2", cursive;
      font-size: clamp(30px, 5vw, 48px);
      line-height: 1.08;
      color: #b11354;
      letter-spacing: 0.2px;
      text-wrap: balance;
    }

    .sub {
      margin: 10px 0 0;
      font-size: clamp(14px, 2.1vw, 17px);
      color: #aa2c62;
    }

    .button-playground {
      position: relative;
      margin-top: 18px;
      min-height: 130px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255, 214, 233, 0.72), rgba(255, 195, 222, 0.5));
      border: 1px dashed rgba(255, 102, 163, 0.35);
      overflow: hidden;
      padding: 12px;
    }

    .buttons-row {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      min-height: 100px;
    }

    .btn {
      border: 0;
      border-radius: 999px;
      min-width: 104px;
      padding: 12px 18px;
      font-family: "Baloo 2", cursive;
      font-size: 24px;
      line-height: 1;
      cursor: pointer;
      box-shadow: 0 8px 24px rgba(255, 88, 150, 0.25);
      transition: transform 0.18s ease, filter 0.2s ease;
    }

    .btn:active { transform: scale(0.98); }

    #yesBtn {
      background: linear-gradient(135deg, #ff86b8, #ff4f90);
      color: #fff;
      animation: heartbeat 1.25s infinite;
    }

    #yesBtn:hover { filter: brightness(1.06); transform: scale(1.06); }

    #noBtn {
      background: #ffe4f0;
      color: #ce2d70;
    }

    #noBtn.evading {
      position: absolute;
      z-index: 4;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      14% { transform: scale(1.08); }
      28% { transform: scale(0.93); }
      42% { transform: scale(1.12); }
      70% { transform: scale(0.99); }
    }

    .reveal {
      margin-top: 14px;
      display: none;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 238, 246, 0.95);
      border: 1px solid rgba(255, 138, 183, 0.35);
      animation: showUp 0.35s ease;
    }

    .reveal.show { display: flex; }

    .reveal img {
      width: 92px;
      height: 92px;
      object-fit: cover;
      border-radius: 14px;
      border: 2px solid rgba(255, 134, 184, 0.5);
      box-shadow: 0 8px 18px rgba(255, 95, 155, 0.25);
      flex-shrink: 0;
    }

    .reveal p {
      margin: 0;
      font-family: "Baloo 2", cursive;
      font-size: clamp(20px, 3.3vw, 30px);
      color: #c40f5a;
      line-height: 1.1;
    }

    .timer-card, .typing-card {
      border-radius: 16px;
      background: rgba(255, 242, 248, 0.85);
      border: 1px solid rgba(255, 151, 194, 0.35);
      padding: 12px;
      margin-bottom: 12px;
    }

    .section-title {
      margin: 0 0 8px;
      font-family: "Baloo 2", cursive;
      font-size: 24px;
      color: #b01153;
      line-height: 1;
    }

    .start-date {
      margin: 0 0 10px;
      color: #a02e60;
      font-size: 13px;
      font-weight: 700;
    }

    .timer-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 8px;
    }

    .timer-item {
      text-align: center;
      background: #fff;
      border: 1px solid rgba(255, 175, 209, 0.45);
      border-radius: 12px;
      padding: 8px 6px;
    }

    .timer-item strong {
      display: block;
      font-size: clamp(18px, 4vw, 26px);
      color: #be155b;
      line-height: 1.1;
    }

    .timer-item span {
      display: block;
      margin-top: 2px;
      font-size: 12px;
      font-weight: 700;
      color: #a63867;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .typing-box {
      min-height: 168px;
      border-radius: 12px;
      background: #fff;
      border: 1px solid rgba(255, 175, 209, 0.45);
      padding: 12px;
      display: flex;
      align-items: center;
    }

    #typingText {
      margin: 0;
      color: #ac1f5c;
      font-weight: 700;
      line-height: 1.5;
      border-right: 2px solid #ff4f90;
      padding-right: 4px;
      white-space: pre-wrap;
      animation: caret 0.8s steps(1) infinite;
    }

    @keyframes caret {
      0%, 50% { border-right-color: #ff4f90; }
      51%, 100% { border-right-color: transparent; }
    }

    @keyframes showUp {
      from { opacity: 0; transform: translateY(8px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    .footer-note {
      margin: 0;
      font-size: 12px;
      color: #b43867;
      text-align: center;
    }

    #confettiCanvas {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 20;
    }

    @media (max-width: 900px) {
      .app-inner { grid-template-columns: 1fr; }
      .timer-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .music-toggle { top: 12px; right: 12px; }
    }

    @media (max-width: 540px) {
      body { padding: 10px; }
      .app { border-radius: 20px; }
      .left, .right { border-radius: 16px; }
      .btn { min-width: 88px; font-size: 22px; padding: 10px 16px; }
      .button-playground { min-height: 118px; }
      .reveal { flex-direction: column; text-align: center; }
    }
  </style>
</head>
<body>
  <div class="background-blur">
    <div class="blob one"></div>
    <div class="blob two"></div>
  </div>
  <div class="hearts-layer" id="heartsLayer"></div>
  <canvas id="confettiCanvas"></canvas>

  <button class="music-toggle" id="musicToggle" aria-label="Bật hoặc tắt nhạc">🔈 Bật nhạc</button>
  <audio id="bgMusic" loop preload="auto"></audio>

  <main class="app">
    <div class="app-inner">
      <section class="left">
        <div class="pill">💖 Valentine Interactive</div>
        <h1 class="big-question">Em có yêu anh không?</h1>
        <p class="sub">Chọn thật lòng nha, tim anh mong manh lắm đó ❤️</p>

        <div class="button-playground" id="playground">
          <div class="buttons-row">
            <button class="btn" id="yesBtn">Có</button>
            <button class="btn" id="noBtn">Không</button>
          </div>
        </div>

        <div class="reveal" id="reveal">
          <img id="couplePhoto" src="anh1.jpg" alt="Ảnh của chúng tôi">
          <p>Anh biết mà! &lt;3</p>
        </div>
      </section>

      <section class="right">
        <article class="timer-card">
          <h2 class="section-title">⏳ Bộ đếm ngày yêu</h2>
          <p class="start-date" id="startDateText">Bắt đầu từ: ...</p>
          <div class="timer-grid">
            <div class="timer-item"><strong id="days">0</strong><span>Ngày</span></div>
            <div class="timer-item"><strong id="hours">0</strong><span>Giờ</span></div>
            <div class="timer-item"><strong id="minutes">0</strong><span>Phút</span></div>
            <div class="timer-item"><strong id="seconds">0</strong><span>Giây</span></div>
          </div>
        </article>

        <article class="typing-card">
          <h2 class="section-title">💌 Lời chúc</h2>
          <div class="typing-box">
            <p id="typingText"></p>
          </div>
        </article>

        <p class="footer-note">Mỗi ngày bên em là một ngày hạnh phúc hơn hôm qua ✨</p>
      </section>
    </div>
  </main>

  <script>
    // ====== CONFIG ======
    // Thay ngày bắt đầu của bạn ở đây, ví dụ: 2023-01-01
    const LOVE_START_DATE = "2021-01-01T00:00:00";
    const COUPLE_PHOTO = "anh1.jpg";
    const MUSIC_SOURCES = [
      "https://files.catbox.moe/5iyzb4.mp3",
      "https://files.catbox.moe/5iyzb4.mp3",
      "https://cdn.pixabay.com/download/audio/2022/03/15/audio_2f48e5072e.mp3?filename=romantic-ambient-11268.mp3"
    ];
    const UNIVERSE_URL = "index2.html";
    const REDIRECT_AFTER_YES_MS = 1800;
    const WISHES = [
      "Em vẫn thường mang vị ngọt đến cho mọi người qua những chiếc bánh em làm. Nhưng em có biết không? Với anh, chính em mới là điều ngọt ngào nhất trên thế giới này. Cảm ơn em đã vất vả, đã luôn cố gắng và đã chọn ở bên cạnh anh. Valentine này, hãy tạm gác lại những đơn hàng, để anh được chăm sóc và mang sự ngọt ngào ấy ngược lại cho em nhé. Yêu em"
    ];

    const heartsLayer = document.getElementById("heartsLayer");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const playground = document.getElementById("playground");
    const reveal = document.getElementById("reveal");
    const couplePhoto = document.getElementById("couplePhoto");
    const music = document.getElementById("bgMusic");
    const musicToggle = document.getElementById("musicToggle");
    const typingText = document.getElementById("typingText");

    // Placeholders if local files are missing.
    couplePhoto.src = COUPLE_PHOTO;
    couplePhoto.onerror = () => {
      couplePhoto.src = "https://images.unsplash.com/photo-1520854221050-0f4caff449fb?auto=format&fit=crop&w=900&q=80";
    };

    // -------- Background hearts --------
    function createFallingHearts(total = 36) {
      for (let i = 0; i < total; i += 1) {
        const heart = document.createElement("span");
        heart.className = "falling-heart";
        heart.textContent = Math.random() > 0.5 ? "❤" : "♡";
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.fontSize = `${12 + Math.random() * 18}px`;
        heart.style.animationDuration = `${8 + Math.random() * 10}s`;
        heart.style.animationDelay = `${-Math.random() * 18}s`;
        heart.style.setProperty("--drift", `${-45 + Math.random() * 90}px`);
        heartsLayer.appendChild(heart);
      }
    }
    createFallingHearts();

    // -------- Love timer --------
    const daysEl = document.getElementById("days");
    const hoursEl = document.getElementById("hours");
    const minutesEl = document.getElementById("minutes");
    const secondsEl = document.getElementById("seconds");
    const startDateText = document.getElementById("startDateText");
    const startDate = new Date(LOVE_START_DATE);

    if (Number.isNaN(startDate.getTime())) {
      startDateText.textContent = "Ngày bắt đầu không hợp lệ. Hãy sửa LOVE_START_DATE trong code.";
    } else {
      startDateText.textContent = `Bắt đầu từ: ${startDate.toLocaleDateString("vi-VN")}`;
    }

    function updateTimer() {
      if (Number.isNaN(startDate.getTime())) return;
      const now = new Date();
      const diff = Math.max(0, now - startDate);

      const totalSeconds = Math.floor(diff / 1000);
      const days = Math.floor(totalSeconds / 86400);
      const hours = Math.floor((totalSeconds % 86400) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;

      daysEl.textContent = String(days);
      hoursEl.textContent = String(hours).padStart(2, "0");
      minutesEl.textContent = String(minutes).padStart(2, "0");
      secondsEl.textContent = String(seconds).padStart(2, "0");
    }
    updateTimer();
    setInterval(updateTimer, 1000);

    // -------- Typing effect --------
    let charIndex = 0;

    function runTyping() {
      const text = WISHES[0];
      typingText.textContent = text.slice(0, charIndex);
      if (charIndex <= text.length) {
        charIndex += 1;
        setTimeout(runTyping, 32 + Math.random() * 22);
      }
    }
    runTyping();

    // -------- No button runs away --------
    function moveNoButton() {
      const playgroundRect = playground.getBoundingClientRect();
      const buttonRect = noBtn.getBoundingClientRect();
      const maxX = Math.max(0, playgroundRect.width - buttonRect.width - 10);
      const maxY = Math.max(0, playgroundRect.height - buttonRect.height - 10);
      const x = Math.random() * maxX;
      const y = Math.random() * maxY;

      noBtn.classList.add("evading");
      noBtn.style.left = `${x}px`;
      noBtn.style.top = `${y}px`;
    }

    noBtn.addEventListener("mouseenter", moveNoButton);
    noBtn.addEventListener("touchstart", (event) => {
      event.preventDefault();
      moveNoButton();
    }, { passive: false });
    noBtn.addEventListener("click", (event) => {
      event.preventDefault();
      moveNoButton();
    });

    // -------- Confetti --------
    const confettiCanvas = document.getElementById("confettiCanvas");
    const confettiCtx = confettiCanvas.getContext("2d");
    let confettiParticles = [];
    let confettiAnimating = false;

    function resizeConfettiCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    resizeConfettiCanvas();
    window.addEventListener("resize", resizeConfettiCanvas);

    function spawnConfetti() {
      const cx = window.innerWidth * 0.5;
      const cy = window.innerHeight * 0.42;
      const colors = ["#ff3b8f", "#ffa3c8", "#ffdfef", "#ffffff", "#ff7fb4"];

      confettiParticles = Array.from({ length: 230 }, () => {
        const angle = Math.random() * Math.PI * 2;
        const speed = 4 + Math.random() * 9;
        return {
          x: cx,
          y: cy,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed - 4,
          gravity: 0.15 + Math.random() * 0.2,
          size: 3 + Math.random() * 6,
          rotation: Math.random() * Math.PI,
          rotationSpeed: -0.2 + Math.random() * 0.4,
          alpha: 1,
          color: colors[Math.floor(Math.random() * colors.length)]
        };
      });
    }

    function animateConfetti() {
      confettiCtx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);

      confettiParticles.forEach((p) => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += p.gravity;
        p.rotation += p.rotationSpeed;
        p.alpha -= 0.006;

        confettiCtx.save();
        confettiCtx.globalAlpha = Math.max(0, p.alpha);
        confettiCtx.translate(p.x, p.y);
        confettiCtx.rotate(p.rotation);
        confettiCtx.fillStyle = p.color;
        confettiCtx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
        confettiCtx.restore();
      });

      confettiParticles = confettiParticles.filter((p) =>
        p.alpha > 0 &&
        p.y < confettiCanvas.height + 40 &&
        p.x > -40 &&
        p.x < confettiCanvas.width + 40
      );

      if (confettiParticles.length > 0) {
        requestAnimationFrame(animateConfetti);
      } else {
        confettiAnimating = false;
      }
    }

    function launchConfetti() {
      spawnConfetti();
      if (!confettiAnimating) {
        confettiAnimating = true;
        animateConfetti();
      }
    }

    // -------- Music toggle --------
    let musicSourceIndex = 0;
    let musicReady = false;

    function applyMusicSource(index) {
      musicSourceIndex = index;
      music.src = MUSIC_SOURCES[index];
      music.load();
    }

    function setMusicButton(isPlaying) {
      musicToggle.textContent = isPlaying ? "🔊 Tắt nhạc" : "🔈 Bật nhạc";
    }

    music.addEventListener("canplaythrough", () => {
      musicReady = true;
    });

    music.addEventListener("error", () => {
      if (musicSourceIndex < MUSIC_SOURCES.length - 1) {
        applyMusicSource(musicSourceIndex + 1);
      }
    });

    musicToggle.addEventListener("click", async () => {
      if (!music.src) applyMusicSource(0);
      if (music.paused) {
        try {
          await music.play();
          setMusicButton(true);
        } catch (error) {
          console.warn("Không thể phát nhạc:", error);
        }
        return;
      }
      music.pause();
      setMusicButton(false);
    });

    applyMusicSource(0);
    setMusicButton(false);

    async function tryAutoPlayMusic() {
      if (!musicReady) return;
      if (!music.paused) return;
      try {
        await music.play();
        setMusicButton(true);
      } catch (_) {
        setMusicButton(false);
      }
    }

    // -------- Yes button action --------
    let answeredYes = false;
    yesBtn.addEventListener("click", async () => {
      if (answeredYes) return;
      answeredYes = true;

      reveal.classList.add("show");
      noBtn.style.display = "none";
      launchConfetti();
      await tryAutoPlayMusic();
      sessionStorage.setItem("autoPlayUniverseMusic", "1");
      setTimeout(() => {
        window.location.href = `${UNIVERSE_URL}?autoplay=1`;
      }, REDIRECT_AFTER_YES_MS);
    });
  </script>
</body>
</html>


